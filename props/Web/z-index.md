### _Для кого, когда и как работает `z-index`_

- `z-index` работает только для элементов у кого `position: !== static`
  То есть для тех у кого `position: relative/absolute/fixed/sticky`
- Отрицательный `z-index: -10`, задвигает элемент под **_обычный `document flow`_**
  То есть так можно задвинуть любой элемент с `position`, под обычный элемент у которого нет `position`
- При `opasity: <= 1`, например `opasity: 0.99` - элемент приравнивается к бэкграунду и становится самым низкоприоритетным элементом.
- Контейнер задает общий приоритет в позиционировании для себя и всех элементов внутри него.
- Элементы внутри одного контекста стека не могут перекрывать элементы в другом контексте стека:
	- Дочерние элементы соревнуются за приоритет только локально, в своем контейнере, не имея возможности перекрыть своим "дочерним приоритетом" сторонние, не дочерние контейнеры 
	- Псевдоэлементы (`::before` и `::after`) так же наследуют `z-index` от своего родительского элемента

```
<div class="one">
	<div class="two"></div>
	<div class="three"></div>
</div>

<div class="four"></div>
```

```
div {
	width: 200px;
	height: 200px;
	padding: 20px;
}

.one, .two, .three, .four {
	position: absolute;
}

.one {
	background: #f00;
	outline: 5px solid #000;
	top: 100px;
	left: 200px;
	z-index: 10;
}
.two {
	background: #0f0;
	outline: 5px solid #000;
	top: 50px;
	left: 75px;
	z-index: 100;
}
.three {
	background: #0ff;
	outline: 5px solid #000;
	top: 125px;
	left: 25px;
	z-index: 150;
}
.four {
	background: #00f;
	outline: 5px solid #ff0;
	top: 200px;
	left: 350px;
	z-index: 50;
}
```

![[Pasted image 20230920174947.png]]

`------- Контейнер -------`
- .one — z-index = 10 <- Родитель задает приоритет позиции для контейнера целиком
- .two — z-index = 10.100 <- Дочерние элементы могут соревноваться за приоритет только...
- .three — z-index = 10.150 <- ... локально, внутри контейнера
`------------------------`
- .four — z-index = 50 <- Отдельный контейнер который соревнуется за приоритет с родителем - контейнером `.one`

### _Stacking Contexts and Stacking Levels_

![[Pasted image 20230920132718.png]]

- Изначально у документа _(внутри тега `<html>`_) существует один основной `Stacking Context` (некий "пол")
- Все, что находится внутри тега `html`, располагается на уровне стекового размещения в пределах этого основного контекста (объекты находятся на "полу").
- При присваивании элементу значения `z-index`, отличное от `auto`, мы создаем новых `context` для `stacking` размещения уже на нем. (поставили "стол" на "пол")
  Этот локальный контекст для стекирования доступен только для дочерних элементов.

### _Stacking Order_

![[Pasted image 20230920132334.png]]

1. **Background, opacity and borders** - Самый низкий уровень в стеке.
2. **Negative Z-Index** - задвигает элемент с `позиционированием` даже под обычный у которого нет position.
3. **Block Level Boxes** - Обычные элементы без позиционирования.
4. **Floated Boxes** - `float` элементы
5. **Inline Boxes** - дочерние элементы `float-а`.
6. **Z-index: 0** - Элементы с `position: relative/absolute/fixed`. Формируют новый контекст стекирования.
7. **Positive Z-index** - Элементы с `z-index: 1>=

---

- Чем больше `z-index`, тем приоритетней и выше располагается блок.
  Таким образом,`relative` элемент может перекрывать `absolute`.

- Если в одном месте страницы оказываются несколько `absolute` блоков, то они перекрывают друг друга.
  По умолчанию выше оказывается тот блок, который расположен ниже в коде страницы.

### *Когда z-index может не сработать ожидаемым образом*

- `position: static`
- Элемент находятся в разных контекстах стека (stacking contexts)
- Если у элемента прозрачный или полупрозрачный (`opacity <= 1`)
- `transform` с любым значением у элемента, кроме `none`, это создает новый контекст стека.
- `filter` также может создать новый контекст стека. (например `filter: blur(5px);`)


![[stacking context]]
